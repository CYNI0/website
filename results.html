<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spotify Outfit - Results Page</title>
  <link rel="stylesheet" href="ResultsPage.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
 document.addEventListener("DOMContentLoaded", function() {
    var clientId = "ceae01a497814f499f7aebd4830653cb"; // Replace with your actual client_id
    var clientSecret = "7a87df79d2744e1ab3ef79e6f1488f8d"; // Replace with your actual client_secret

    function getAccessToken() {
        return new Promise((resolve, reject) => {
            $.ajax({
                url: "https://accounts.spotify.com/api/token",
                type: "POST",
                headers: {
                    "Authorization": "Basic " + btoa(clientId + ":" + clientSecret)
                },
                data: {
                    "grant_type": "client_credentials"
                },
                success: function(response) {
                    console.log("Access Token:", response.access_token);
                    resolve(response.access_token);
                },
                error: function(xhr, status, error) {
                    console.error("Error fetching access token:", error);
                    reject(error);
                }
            });
        });
    }

    function fetchUserTopArtistAndGenre(accessToken) {
        $.ajax({
            url: "https://api.spotify.com/v1/me/top/artists?time_range=short_term&limit=1",
            type: "GET",
            headers: {
                "Authorization": "Bearer " + accessToken
            },
            success: function(response) {
                console.log("API Response:", response);
                const mainGenreElement = $('#genre-name');
                const artistContainer = $('#artist-container');
                const artistNameElement = $('#artist-name');
                const artistImageElement = $('#artist-image');

                if (response.items.length > 0) {
                    const topArtist = response.items[0];
                    const genres = topArtist.genres;
                    const artistName = topArtist.name;
                    const artistImage = topArtist.images.length > 0 ? topArtist.images[0].url : null;

                    // Display the main genre
                    const mainGenre = genres.length > 0 ? genres[0] : "No genre available";
                    mainGenreElement.text(mainGenre);

                    // Display the artist details
                    artistNameElement.text(artistName);
                    if (artistImage) {
                        artistImageElement.attr('src', artistImage);
                        artistImageElement.show();
                    } else {
                        artistImageElement.hide();
                    }
                    artistContainer.show();
                } else {
                    mainGenreElement.text("No genre available.");
                    artistContainer.hide();
                }
            },
            error: function(xhr, status, error) {
                console.error("Error fetching artist data:", error);
            }
        });
    }

    getAccessToken().then(accessToken => {
        fetchUserTopArtistAndGenre(accessToken);
    }).catch(error => {
        console.error("Error fetching access token:", error);
    });

    $("#logout-button").click(function() {
        sessionStorage.removeItem('searchResults');
        sessionStorage.removeItem('selectedMood');
        window.location.href = "https://cyni0.github.io/website/";
    });
});

    </script>
</head>
<body>

    <div class="results-page">
        <div class="results-container">
            <h1 class="main-genre">Your main genre is...</h1>
            <h2 id="genre-name" class="genre">Loading...</h2>

            <div id="artist-container" class="artist-container" style="display: none;">
                <h3 class="artist-title">Your Top Artist:</h3>
                <p id="artist-name" class="artist-name"></p>
                <img id="artist-image" alt="Top Artist" class="artist-image" style="width: 200px; height: auto; border-radius: 10px;" />
            </div>
                <h3 class="outfit-title">Here is your outfit!</h3>
      <img id="outfit-image" src="outfit-placeholder.png" alt="Outfit" class="outfit-image" />
        </div>
    </div>
</body>
</html>
