<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spotify Outfit - Results Page</title>
  <link rel="stylesheet" href="ResultsPage.css">
</head>
<body>
  <div class="results-page">
    <div class="results-container">
      <h1 class="main-genre">Your main genre is...</h1>
      <h2 id="genres" class="genre">Loading...</h2>

      <div id="artist-container" class="artist-container" style="display: none;">
        <h3 class="artist-title">Your Top Artist:</h3>
        <p id="artistName" class="artist-name"></p>
        <img id="artistImage" alt="Top Artist" class="artist-image" />
      </div>

      <h3 class="outfit-title">Here is your outfit!</h3>
      <img id="outfit-image" src="outfit-placeholder.png" alt="Outfit" class="outfit-image" />

      <!-- Logout Button -->
      <button id="logout-button" class="logout-button">Logout</button>
    </div>
  </div>

  <script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            var clientId = "ceae01a497814f499f7aebd4830653cb"; // Replace with your actual client_id
            var clientSecret = "7a87df79d2744e1ab3ef79e6f1488f8d"; // Replace with your actual client_secret

            // Function to get access token
            function getAccessToken() {
                return new Promise((resolve, reject) => {
                    $.ajax({
                        url: "https://accounts.spotify.com/api/token",
                        type: "POST",
                        headers: {
                            "Authorization": "Basic " + btoa(clientId + ":" + clientSecret)
                        },
                        data: {
                            "grant_type": "client_credentials"
                        },
                        success: function(response) {
                            resolve(response.access_token);
                        },
                        error: function(xhr, status, error) {
                            reject(error);
                        }
                    });
                });
            }

            // Function to fetch user's top artist and main genre
            function fetchUser TopArtistAndGenre(accessToken) {
                $.ajax({
                    url: "https://api.spotify.com/v1/me/top/artists?time_range=short_term&limit=1",
                    type: "GET",
                    headers: {
                        "Authorization": "Bearer " + accessToken
                    },
                    success: function(response) {
                        if (response.items.length > 0) {
                            const topArtist = response.items[0];
                            const artistName = topArtist.name;
                            const genres = topArtist.genres;
                            const artistImage = topArtist.images.length > 0 ? topArtist.images[0].url : null;
                            // Display the top artist and main genre
                            const mainGenre = genres.length > 0 ? genres[0] : "No genre available";
                            $('#results').html(`<h2>Your Top Artist: ${artistName}</h2><h3>Main Genre: ${mainGenre}</h3>`);
                        } else {
                            $('#results').html("<h2>No top artist found.</h2>");
                        }
                    },
                    error: function(xhr, status, error) {
                        console.log(error);
                    }
                });
            }

            // Fetch and display the top artist and genre on page load
            getAccessToken().then(accessToken => {
                fetchUser TopArtistAndGenre(accessToken);
            }).catch(error => {
                console.error("Error fetching access token:", error);
            });


        });
  </script>
</body>
</html>
